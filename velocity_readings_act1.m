% voltage measurements (in mV) from current sensing amplifier were copied
% over from Arduino 1.8.19 Serial Monitor Output from COM3
CUR_MEAS = [% d = 10%
            [1694 1698 1702 1708 1711 1715 1720 1723 1725 1727 1729 1721 1734 1735 1743 1741 1738 1740 1739 1740 1742 1741 1741 1742 1742 1741 1740 1741 1742 1741 1741 1740 1740 1741 1739 1741 1740 1739 1739 1738 1737 1739 1737 1737 1806 1726 1738 1736 1737 1737 1744 1735 1735 1735 1735 1736 1735]
            [1793 1797 1800 1802 1806 1810 1812 1813 1814 1845 1817 1817 1818 1818 1817 1818 1821 1820 1819 1817 1817 1820 1817 1817 1815 1815 1815 1814 1814 1825 1813 1813 1811 1815 1851 1810 1812 1809 1808 1808 1807 1806 1805 1804 1804 1802 1801 1800 1800 1800 1799 1787 1800 1798 1825 1805 1798]
            [1677 1683 1687 1693 1698 1698 1705 1706 1707 1710 1712 1713 1714 1715 1715 1716 1718 1716 1719 1719 1713 1719 1719 1719 1721 1721 1719 1720 1719 1719 1715 1719 1719 1719 1696 1719 1716 1721 1716 1719 1718 1716 1718 1716 1713 1716 1714 1730 1715 1715 1718 1719 1726 1731 1735 1737 1740]
            [1678 1683 1683 1694 1697 1700 1701 1705 1708 1708 1711 1710 1714 1715 1716 1668 1716 1715 1716 1716 1715 1716 1719 1719 1718 1718 1718 1718 1719 1719 1719 1716 1711 1715 1715 1714 1719 1715 1715 1786 1702 1723 1725 1729 1735 1737 1742 1741 1745 1747 1749 1749 1749 1750 1749 1749 1749]
            [1684 1689 1694 1698 1701 1737 1708 1711 1711 1712 1715 1716 1719 1719 1720 1720 1719 1721 1722 1722 1720 1723 1721 1722 1721 1721 1723 1723 1722 1723 1721 1723 1721 1720 1723 1728 1735 1719 1741 1745 1747 1749 1749 1750 1751 1750 1751 1753 1754 1754 1754 1753 1757 1754 1754 1753 1754]
            [1916 1922 1925 1927 1928 1929 1930 1930 1931 1932 1932 1932 1932 1931 1929 1929 1930 1928 1928 1927 1926 1926 1924 1921 1920 1919 1920 1916 1916 1917 1922 1925 1928 1928 1928 1930 1932 1930 1932 1930 1929 1930 1930 1929 1929 1928 1928 1928 1927 1904 1924 1920 1920 1920 1917 1916 1916]
            [1678 1683 1685 1691 1696 1698 1700 1703 1706 1705 1708 1710 1708 1711 1711 1711 1712 1711 1713 1712 1712 1713 1723 1713 1713 1715 1722 1724 1727 1732 1735 1738 1739 1743 1744 1742 1745 1745 1748 1747 1747 1748 1749 1749 1748 1735 1748 1748 1749 1749 1749 1751 1758 1761 1766 1771 1773]
            [1696 1700 1705 1710 1711 1715 1716 1721 1721 1723 1723 1723 1723 1724 1725 1726 1725 1727 1727 1726 1726 1726 1732 1736 1741 1746 1748 1749 1750 1754 1754 1757 1759 1758 1760 1759 1761 1761 1750 1766 1761 1761 1761 1761 1769 1774 1776 1778 1782 1786 1788 1787 1790 1790 1791 1721 1793]
            [1696 1698 1698 1702 1703 1706 1707 1708 1710 1711 1711 1710 1713 1713 1703 1711 1712 1720 1723 1726 1729 1732 1738 1737 1739 1740 1745 1739 1744 1744 1733 1747 1747 1747 1747 1747 1747 1750 1754 1761 1769 1770 1772 1773 1767 1775 1775 1777 1795 1775 1777 1778 1776 1778 1778 1778 1780]
            % d = 20%
            [1772 1774 1778 1782 1809 1788 1794 1791 1799 1800 1800 1801 1804 1805 1806 1807 1808 1808 1810 1810 1812 1810 1812 1812 1795 1801 1812 1812 1810 1812 1810 1813 1809 1808 1808 1807 1808 1805 1806 1805 1802 1809 1802 1802 1800 1769 1800 1800 1799 1798 1798 1799 1799 1792 1797 1794 1795]
            [1809 1813 1814 1818 1825 1825 1825 1828 1830 1833 1834 1837 1837 1837 1838 1839 1839 1850 1839 1840 1840 1840 1839 1839 1839 1837 1825 1837 1837 1834 1834 1833 1833 1830 1830 1829 1830 1828 1826 1826 1825 1834 1825 1825 1825 1823 1821 1822 1821 1821 1842 1817 1817 1887 1798 1814 1814]
            [1846 1850 1852 1846 1858 1861 1864 1866 1866 1869 1919 1872 1873 1874 1873 1874 1874 1837 1873 1871 1871 1871 1869 1869 1868 1868 1865 1865 1865 1862 1865 1863 1861 1861 1860 1886 1857 1855 1853 1854 1853 1852 1851 1851 1851 1849 1849 1849 1846 1829 1847 1851 1853 1855 1860 1862 1865]
            [1884 1826 1892 1896 1898 1901 1902 1903 1904 1907 1907 1908 1928 1906 1908 1910 1906 1907 1905 1903 1904 1902 1902 1901 1901 1902 1901 1899 1897 1896 1896 1893 1892 1890 1890 1889 1887 1885 1884 1925 1885 1889 1892 1900 1900 1900 1902 1903 1904 1906 1907 1908 1907 1907 1907 1907 1907]
            [1920 1924 1928 1928 1929 1933 1933 1935 1936 1938 1940 1940 1938 1911 1937 1938 1936 1943 1935 1933 1932 1931 1930 1929 1928 1928 1928 1925 1924 1919 1920 1918 1918 1916 1919 1928 1930 1928 1932 1932 1935 1938 1936 1938 1939 1939 1940 1939 1938 1936 1938 1913 1935 1928 1932 1930 1929]
            [1948 1906 1954 1957 1948 1964 1979 1965 1967 1967 1967 1966 1966 1967 1966 1966 1964 1963 1963 1953 1959 1959 1957 1939 1954 1953 1952 1952 1951 1952 1954 1956 1959 1964 1964 1965 1966 1966 1967 1967 1966 1967 1966 1966 1964 1963 1960 1961 1963 1958 1955 1955 1953 1953 1953 1952 1892]
            [1974 1989 1979 1979 1981 1982 1983 1984 1987 1987 1986 1984 1987 1984 1983 1984 1981 1981 1979 1978 1979 1975 1975 1973 1973 1974 1975 1979 1980 1980 1984 1984 1984 1987 1986 1984 1986 1986 1991 1983 1981 1982 1979 1979 1978 1977 1976 1975 1974 1971 1971 1976 1979 1981 1927 1986 1986]
            [2004 2029 2011 2013 2015 2016 2017 2015 2019 2016 2019 2017 2017 2017 2013 2013 2011 2008 1991 2005 2005 2004 2004 2008 2009 2004 2012 2015 2009 2016 2017 2017 2017 2015 2015 2015 2013 2013 2013 2010 2008 2006 2006 2004 2003 2007 2010 2011 2018 2016 2016 2017 2017 2017 2017 2015 2015]
            [2034 2038 2041 2043 2046 2046 2047 2046 2048 2050 2047 2046 2046 2043 2042 2035 2040 2038 2037 2035 2034 2038 2070 2044 2046 2047 2047 2054 2048 2058 2046 2046 2040 2044 2043 2041 2038 2042 2037 2034 2034 2038 2042 2042 2045 2042 2046 2048 2048 2047 2047 2045 2044 2066 2042 2041 2040]
            % d = 30%
            [1780 1787 1790 1799 1758 1800 1802 1806 1806 1812 1811 1811 1813 1813 1815 1814 1814 1817 1817 1814 1819 1820 1819 1820 1821 1821 1821 1821 1821 1821 1824 1821 1821 1821 1818 1821 1820 1821 1820 1825 1817 1817 1817 1816 1815 1814 1814 1813 1813 1814 1811 1812 1812 1811 1809 1810 1805]
            [1825 1827 1830 1835 1839 1841 1844 1791 1849 1849 1850 1851 1851 1852 1853 1852 1857 1854 1856 1855 1856 1860 1855 1856 1856 1854 1856 1857 1853 1920 1849 1851 1851 1851 1850 1850 1850 1848 1806 1828 1846 1843 1844 1843 1841 1839 1840 1838 1839 1837 1836 1837 1837 1833 1831 1840 1829]
            [1865 1869 1873 1877 1877 1881 1881 1885 1885 1888 1888 1890 1891 1892 1894 1892 1892 1893 1894 1895 1892 1902 1890 1892 1891 1888 1888 1886 1887 1885 1884 1888 1881 1881 1879 1877 1879 1877 1877 1876 1876 1875 1872 1872 1869 1869 1866 1867 1865 1865 1865 1873 1876 1877 1881 1879 1901]
            [1903 1906 1911 1925 1916 1916 1919 1920 1923 1924 1926 1927 1927 1928 1928 1928 1928 1928 1927 1927 1927 1924 1925 1995 1923 1920 1920 1919 1916 1915 1914 1986 1912 1927 1911 1908 1901 1905 1902 1903 1903 1906 1915 1914 1917 1919 1919 1911 1924 1927 1926 1927 1928 1928 1928 1928 1927]
            [1936 1942 1945 1948 1951 1952 1953 1955 1953 1957 1958 1958 1911 1956 1945 1958 1956 1971 1969 1955 1954 1953 1953 1951 1953 1948 1948 1945 1945 1941 1944 1940 1939 1938 1941 1945 1949 1950 1952 1953 1955 1955 1955 1958 1959 1959 1959 1958 1960 1955 1958 1955 1957 1953 1953 1953 1952]
            [1966 1969 1971 1975 1971 1979 1979 1979 1981 1982 1981 1981 1980 1983 1981 1981 1991 1979 1979 1978 1977 1974 1975 1974 1969 1969 1967 1967 1966 1966 1971 1974 1975 1979 1979 1979 1980 1981 2017 1982 1982 1981 1994 1979 1980 1979 1979 1978 1976 1975 1975 1971 1971 1971 1967 1967 1966]
            [1992 1995 1999 2003 2003 2004 2004 2008 2007 2007 2007 2005 2007 2005 2004 2004 2004 2003 2003 1999 1999 1928 1995 1994 1994 1992 1997 2000 2003 2004 2012 2004 2009 1961 2006 2006 2010 2009 2005 2005 2004 2004 2005 2002 2003 1999 2000 2015 2007 1991 1994 1999 2002 2003 2004 2004 2006]
            [2029 2030 2031 2035 2037 2038 2040 2041 2043 2042 2041 2040 2041 2034 2046 2038 2034 2034 2031 2030 2030 2028 2028 2029 2032 2004 2018 2040 2040 2040 2041 2042 2042 2010 2041 2038 2036 2107 2034 2027 2031 2030 2030 2029 2029 2035 2030 2034 2035 2038 2038 2040 2041 2042 2030 2041 2040]
            [2059 2061 2062 2067 2068 2068 2068 2070 2070 2069 2065 2068 2068 2068 2066 2064 2063 2061 2057 2057 2055 2061 2064 2066 2074 2069 2070 2068 2069 2069 2069 2069 2068 2067 2066 2069 2061 2059 2059 2061 2090 2061 2066 2066 2069 2067 2069 2069 2069 2070 2069 2068 2067 2067 2067 2041 2064]
            % d = 40%
            [1794 1798 1801 1802 1800 1813 1813 1814 1814 1817 1820 1821 1823 1825 1825 1825 1826 1826 1827 1830 1827 1828 1828 1827 1829 1829 1829 1829 1828 1829 1829 1831 1829 1829 1829 1829 1833 1829 1830 1830 1828 1830 1828 1827 1826 1828 1829 1826 1825 1825 1826 1825 1825 1825 1823 1821 1819]
            [1836 1838 1843 1847 1829 1853 1853 1855 1859 1861 1861 1862 1864 1864 1865 1865 1865 1866 1867 1866 1866 1867 1866 1865 1866 1866 1869 1869 1866 1867 1866 1865 1864 1864 1864 1863 1862 1862 1860 1860 1860 1943 1856 1857 1853 1853 1851 1852 1851 1851 1900 1849 1849 1847 1839 1844 1843]
            [1881 1882 1887 1888 1892 1897 1896 1900 1901 1902 1903 1903 1904 1904 1885 1905 1904 1904 1905 1908 1915 1904 1907 1852 1904 1903 1915 1902 1902 1902 1901 1901 1898 1899 1896 1894 1894 1891 1892 1877 1889 1888 1885 1886 1882 1881 1865 1881 1893 1877 1877 1884 1885 1889 1892 1896 1900]
            [1916 1919 1924 1928 1928 1929 1923 1935 1935 1938 1932 1938 1940 1939 1940 1941 1940 1940 1940 1939 1940 1939 1936 1936 1878 1936 1932 1930 1929 1928 1928 1927 1927 1926 1922 1922 1920 1919 1919 1916 1916 1923 1924 1928 1928 1909 1930 1935 1933 1936 1937 1939 1936 1940 1940 1900 1941]
            [1957 1961 1963 1966 1968 1970 1971 1974 1974 1975 1977 1978 1977 1979 1979 1979 1977 1978 1977 1928 1975 1965 1971 1955 1979 1967 1966 1966 1963 1962 1962 1958 1958 1955 1958 1963 1966 1970 1967 1971 1971 1975 1976 1979 1979 1977 2015 1979 1977 1979 1975 1977 1976 1971 1975 1952 1970]
            [1979 1983 1969 1989 1991 1991 1992 1994 1994 1996 1997 1997 1999 1996 1996 1995 1995 1993 1992 1991 1991 1989 1989 1987 1984 2042 1980 1981 1996 1976 1983 1987 1990 1993 1993 1995 1995 1994 1997 1997 1997 1999 1997 1999 1997 2003 1992 1994 1992 1991 1989 1988 1987 1984 1983 1979 1979]
            [2013 2013 2015 2018 2017 2022 2021 2022 2022 2091 2077 2026 2025 2020 2022 2024 2019 2019 2017 2017 2022 2013 2013 2029 2008 2010 2012 2015 2019 2021 2019 2022 2022 2022 2025 2024 2026 2022 2022 2022 2019 2019 2019 2019 2017 2016 2013 2013 2010 2008 2009 2014 2017 2017 2018 2021 2046]
            [2043 2046 2050 2054 2054 2055 2055 2055 2056 2057 2055 2056 2055 2055 2054 2055 2052 2053 2051 2048 2046 2044 2042 2044 2048 2051 2052 2054 2055 2055 2056 2055 2055 2056 2055 2055 2054 2054 2051 2051 2050 2046 2042 2043 2042 2044 1994 2051 2051 2054 2055 2020 2055 2055 2058 2057 2055]
            [2082 2085 2089 2090 2092 2093 2093 2095 2096 2094 2095 2095 2093 2157 2092 2090 2090 2086 2084 2082 2082 2089 2089 2090 2092 2094 2096 2094 2096 2095 2095 2096 2095 2092 2091 2054 2109 2086 2084 2082 2082 2086 2090 2090 2091 2065 2094 2095 2096 2096 2095 2094 2093 2012 2076 2091 2089]
            % d = 50%
            [1802 1807 1795 1831 1818 1822 1825 1825 1825 1829 1831 1834 1836 1837 1831 1837 1839 1840 1839 1841 1841 1837 1843 1841 1842 1842 1841 1843 1843 1843 1844 1842 1843 1842 1844 1843 1846 1842 1842 1843 1842 1841 1841 1841 1840 1841 1841 1839 1839 1839 1839 1840 1837 1841 1838 1833 1838]
            [1851 1852 1857 1861 1864 1865 1866 1871 1885 1876 1876 1877 1877 1877 1877 1878 1877 1878 1879 1879 1879 1879 1878 1878 1877 1879 1878 1877 1879 1881 1878 1877 1877 1855 1879 1877 1877 1877 1877 1877 1876 1873 1873 1872 1871 1869 1868 1868 1866 1866 1864 1864 1863 1861 1862 1859 1860]
            [1894 1900 1892 1903 1904 1908 1911 1912 1915 1915 1915 1916 1925 1917 1920 1919 1918 1917 1926 1920 1918 1917 1919 1943 1920 1918 1903 1916 1916 1916 1915 1914 1910 1912 1906 1884 1908 1904 1904 1904 1903 1902 1902 1901 1900 1898 1898 1895 1894 1893 1894 1898 1901 1902 1905 1909 1908]
            [1933 1933 1940 1942 1944 1948 1951 1952 1952 1952 1953 1954 1953 1954 1953 1955 1954 1955 1954 1955 1953 1953 1953 1953 1952 1952 1949 1949 1946 1948 1946 1943 2004 1942 1938 1936 1936 1933 1932 1932 1930 1936 1940 1942 1944 1948 1949 1950 1952 1952 1948 1954 1955 1954 1953 1953 1954]
            [1977 2063 1980 1981 1991 1987 1989 1990 1975 2010 1992 1994 1993 1994 1993 1991 1994 1981 1993 2004 1992 1991 1989 1987 1987 1984 1965 1983 1964 1979 1979 1979 1979 1976 1978 1980 1983 1984 1990 1989 1991 1991 1992 1995 1993 1994 1993 1994 1997 1993 1993 1994 1992 1993 2019 1988 1989]
            [1991 1995 1999 2001 2003 2004 2005 2005 2121 2005 2005 2010 2007 2007 2007 2006 2007 2006 2005 2004 2003 2003 2001 1999 2004 1995 1995 1993 1992 1992 1996 1999 2003 2003 2004 2005 2005 2006 2007 2006 2007 2007 2007 2003 2008 2004 2007 2004 2034 2003 2002 2000 2002 1998 1996 1994 1991]
            [2028 2030 2032 2034 2034 2038 2042 2017 2041 2042 2042 2040 2043 2042 2039 2040 2056 2039 2036 2034 2030 2031 2031 2030 2029 2030 2030 2034 2032 2035 2035 2038 2039 2040 2038 2043 2042 2040 2038 2040 2038 2037 2035 2032 2032 2031 2030 2030 2030 2026 2027 2017 2033 2033 2035 2035 2040]
            [2056 2059 2030 2063 2113 2067 2067 2068 2069 2069 2059 2068 2068 2067 2065 2066 2065 2064 2061 2059 2057 2056 2055 2057 2061 2064 2065 2072 2097 2068 2070 2063 2069 2066 2068 2068 2067 2066 2066 2066 2061 2060 2048 2057 2055 2057 2060 2061 2064 2066 2067 2068 2068 2069 2069 2068 2069]
            [2097 2103 2105 2106 2106 2107 2109 2108 2109 2109 2109 2109 2106 2106 2105 2105 2105 2101 2098 2097 2097 2101 2104 2107 2106 2108 2108 2107 2109 2109 2108 2106 2106 2106 2106 2106 2102 2102 2101 2097 2097 2103 2105 2105 2158 2106 2107 2111 2109 2109 2110 2107 2108 2107 2106 2105 2105]
            % d = 60%
            [1821 1825 1826 1829 1843 1837 1837 1840 1841 1844 1846 1847 1849 1849 1851 1851 1851 1852 1853 1851 1853 1853 1852 1853 1852 1855 1853 1854 1854 1853 1853 1854 1853 1852 1853 1855 1853 1852 1852 1852 1852 1851 1851 1785 1851 1852 1850 1851 1851 1851 1851 1851 1851 1851 1849 1849 1849]
            [1867 1868 1873 1876 1877 1881 1877 1884 1887 1888 1891 1890 1893 1888 1888 1896 1893 1895 1896 1896 1893 1895 1896 1895 1892 1893 1893 1893 1892 1891 1894 1892 1892 1891 1890 1892 1890 1890 1889 1888 1888 1884 1892 1889 1886 1884 1888 1884 1882 1881 1881 1880 1879 1877 1877 1877 1876]
            [1902 1904 1910 1911 1915 1916 1916 1919 1922 1920 1923 1925 1924 1924 1927 1926 1928 1926 1928 1927 1927 1924 1932 1925 1887 1926 1925 1922 1922 1922 1920 1920 1919 1884 1920 1918 1916 1915 1914 1912 1914 1911 1910 1908 1907 1908 1904 1932 1903 1902 1904 1906 1908 1912 1915 1917 1916]
            [1949 1953 1953 1955 1955 1960 2018 1965 1965 1965 1965 1965 1967 1967 1966 1968 1966 1966 1966 1966 1965 1965 1965 1965 1966 1964 1971 1962 1961 1958 1961 1955 1955 1954 1953 1953 1952 1949 1949 1946 1949 1953 1953 1955 1959 1948 1963 1962 1970 1966 1967 1968 1949 1968 1967 1967 1967]
            [1982 1987 1990 1991 1995 2003 2000 2004 2003 2003 2003 2004 2003 2004 2003 1946 2004 2003 2003 2002 2003 2002 2000 2000 1996 1997 1992 1992 1992 1990 1991 1986 1983 1983 1987 1991 1992 1995 1997 1997 1999 1937 2003 2004 2003 2003 2003 1997 2003 2003 2003 1997 2003 2003 1999 1998 1999]
            [2007 1964 2015 2016 2018 2019 2021 2023 2024 2024 2022 2024 2025 2025 2025 2026 2022 2023 2022 2022 2019 2019 2018 2017 2015 2015 2014 2017 2009 2009 2010 2017 2018 2019 2019 2024 2023 2024 2025 2026 2027 2025 2023 2025 2026 2025 2023 2021 2019 2019 2019 2016 2041 2030 2013 1979 2010]
            [2034 2037 2040 2043 2044 2046 2047 2046 2050 2050 1994 2050 2050 2050 2048 2050 2048 2045 2042 2044 2042 2041 2019 2038 2035 2034 2038 2041 2044 2043 2045 2047 2055 2045 2050 2048 2046 2048 2046 2048 2046 2045 2045 2042 2043 2040 2038 2037 2034 2034 2032 2039 2038 2041 2044 2046 2047]
            [2070 2073 2075 2078 2079 2080 2081 2081 2082 2081 2081 2081 2081 2081 2080 2080 2079 2077 2077 2074 2073 2069 2068 2072 2074 2077 2080 2080 2080 2081 2081 1995 2081 2081 2072 2081 2081 2080 2079 2077 2074 2073 2072 2066 2070 2071 2074 2077 2078 2114 2080 2081 2081 2082 2082 2106 2081]
            [2106 2107 2111 2111 2114 2117 2117 2118 2117 2128 2118 2117 2117 2117 2115 2113 2111 2109 2108 2107 2106 2109 2110 2112 2117 2117 2108 2117 2117 2117 2119 2117 2115 2115 2114 2114 2110 2109 2106 2106 2106 2107 2110 2112 2113 2115 2117 2095 2117 2117 2162 2115 2114 2115 2112 2110 2096]
            % d = 70%
            [1831 1822 1840 1842 1839 1850 1851 1853 1853 1857 1859 1861 1861 1863 1864 1864 1860 1863 1864 1864 1865 1869 1863 1865 1864 1865 1865 1864 1864 1838 1865 1864 1864 1864 1864 1857 1864 1863 1863 1862 1862 1863 1864 1920 1861 1862 1861 1922 1861 1825 1861 1859 1860 1860 1859 1860 1857]
            [1876 1881 1884 1906 1889 1893 1895 1900 1900 1901 1902 1902 1902 1902 1902 1904 1903 1904 1935 1904 1903 1904 1903 1903 1903 1905 1902 1904 1902 1928 1902 1902 1902 1902 1902 1902 1900 1899 1900 1900 1900 1889 1897 1897 1895 1893 1894 1893 1894 1893 1891 1891 1890 1888 1891 1887 1884]
            [1916 1919 1924 1925 1928 1929 1932 1932 1933 1936 1936 1936 1938 1938 1938 1938 1940 1936 1928 1938 1938 1938 1936 1939 1952 1936 1935 1935 1936 1932 1933 1933 1933 1932 1930 1929 1928 1928 1928 1928 1926 1925 1924 1924 1922 1920 1919 1916 1916 1912 1916 1920 1924 1927 1887 1929 1932]
            [1958 1961 1966 1966 1968 1970 1972 1974 1975 1975 1979 1975 1978 1978 1978 1979 1980 1978 1977 1978 1978 1975 1973 1975 1973 1990 1971 1969 1969 1968 1967 1966 1967 1966 1964 1963 1959 1959 1958 1955 1957 1959 1962 1966 1968 1970 1971 1973 1973 1974 1975 1977 1976 1977 1976 1978 1978]
            [1997 2030 2004 2005 1994 2008 2010 2015 2015 2015 2014 2038 2030 2018 2015 2016 2013 2015 2015 2013 2013 2013 2011 2010 2010 2008 2007 2007 2005 2004 2004 2002 2001 1999 2003 2005 2007 2008 2009 2010 2014 2014 2015 2015 2016 2019 2002 2016 2016 2015 2013 2012 2012 2015 2010 2011 2008]
            [2017 1977 2021 2022 2025 2028 2029 2030 2029 2030 2030 2029 2030 2074 2029 2030 2029 2027 2026 2029 2026 2025 2024 2034 2022 2019 2017 2017 2016 2019 2019 2022 2025 2028 2029 2030 2030 2030 2030 2030 2028 2030 2030 2029 2029 2027 2029 2029 2029 2024 2022 2047 2022 2019 2017 2018 2017]
            [2042 2045 2046 2050 2052 2054 2054 2055 2055 2055 2055 2055 2055 2055 2054 2055 2054 2054 2050 2050 2052 2046 2045 2045 2042 2043 2046 2048 2047 2051 2054 2053 2015 2054 2055 2055 2054 2053 2054 2054 2051 2050 2050 2051 2046 2046 2045 2042 2042 2040 2039 2045 2045 2048 2051 2053 2053]
            [2076 2078 2081 2081 2081 2085 2086 2086 2086 2086 2086 2086 2085 2086 2085 2082 2085 2081 2081 2070 2080 2076 2078 2106 2081 2081 2082 2086 2085 2088 2086 2086 2088 2086 2085 2083 2083 2083 2081 2081 2081 2079 2078 2072 2075 2077 2080 2081 2082 2085 2085 2086 2086 2086 2088 2085 2086]
            [2110 2112 2115 2119 2119 2120 2119 2121 2120 2121 2120 2119 2121 2119 2118 2117 2116 2115 2113 2110 2109 2114 2116 2169 2120 2120 2117 2118 2120 2120 2121 2120 2120 2119 2118 2118 2115 2115 2113 2085 2111 2112 2115 2119 2119 2121 2120 2121 2123 2121 2119 2121 2120 2119 2117 2050 2117]
            % d = 80%
            [1846 1850 1853 1853 1857 1861 1857 1843 1866 1868 1860 1877 1872 1872 1874 1874 1874 1875 1875 1871 1877 1872 1873 1876 1877 1876 1876 1881 1876 1875 1874 1875 1864 1874 1874 1872 1872 1872 1873 1877 1873 1873 1869 1928 1800 1869 1869 1869 1872 1869 1869 1850 1869 1868 1866 1868 1873]
            [1892 1895 1900 1901 1953 1904 1925 1910 1912 1915 1913 1915 1915 1916 1918 1916 1918 1917 1916 1920 1916 1916 1916 1916 1915 1916 1915 1920 1915 1915 1914 1915 1973 1913 1912 1911 1912 1911 1909 1909 1908 1906 1907 1907 1906 1906 1903 1904 1912 1902 1904 1902 1902 1874 1902 1902 1900]
            [1917 1920 1924 1923 1929 1931 1932 1932 1936 1937 1936 1937 1938 1939 1938 1938 1940 1914 1940 1940 1938 1937 1937 1935 1933 1935 1935 1935 1932 1931 1933 1932 1932 1927 1930 1928 1928 1928 1928 1928 1928 1927 1925 1925 1924 1915 1923 1919 1917 1917 1920 1923 1926 1928 1928 1931 1932]
            [1958 1962 1966 1967 1961 1971 1971 1973 1975 1975 1977 1976 1992 1977 1977 1977 1976 1983 1975 1976 1976 1973 1974 1972 1971 1967 1971 1970 1968 1968 1967 1968 1966 1966 1964 1966 1961 1962 1959 1957 1960 1961 1966 1967 1968 1964 1974 1977 1975 1976 1975 1976 1977 1975 1977 1978 1976]
            [1977 1979 1980 1983 1986 1987 1987 1988 1988 1989 1989 1991 1989 1989 1991 1989 1987 1989 1988 1987 1992 1983 1983 1983 1981 1981 1979 1979 1979 1979 1979 1978 1975 1975 1979 1979 1981 1983 1987 1990 1987 1989 1987 1990 1991 1988 1990 1988 1989 1988 2025 1986 1985 1984 1984 1983 1982]
            [2014 2017 2017 2019 2022 2022 2024 2025 2026 2030 2027 2028 2027 2026 2028 2025 2026 2025 2024 2025 2022 2022 2021 2019 2019 2002 2016 2013 2013 2015 2017 2021 2024 2022 2024 2027 2026 2028 2027 2027 2029 2028 2026 2025 2026 2026 2024 2022 2022 2021 2019 2019 2018 2017 2017 2014 2015]
            [2043 2044 2050 2050 2053 2054 2054 2055 2055 2056 2055 2055 2055 2055 2055 2055 2061 2051 2051 2050 2048 2048 2045 2045 2044 2043 2046 2050 2051 2094 2054 2054 2054 2055 2055 2055 2091 2055 2055 2055 2054 2054 2054 2053 2048 2047 2048 2045 2046 2042 2043 2047 2050 2051 2054 2054 2055]
            [2069 2071 2072 2075 2077 2078 2089 2080 2079 2079 2081 2080 2080 2081 2078 2078 2079 2076 2073 2074 2072 2069 2068 2070 2075 2076 2077 2078 2078 2080 2081 2081 2079 2081 2079 2077 2078 2077 2077 2076 2073 2073 2072 2070 2068 2070 2109 2075 2081 2078 2080 2080 2080 2080 2081 2080 2079]
            [2099 2099 2104 2105 2105 2106 2106 2106 2106 2106 2108 2106 2105 2105 2105 2105 2101 2101 2097 2097 2120 2101 2105 2106 2105 2097 2106 2106 2107 2106 2106 2106 2109 2105 2105 2102 2095 2101 2097 2098 2101 2165 2102 2104 2105 2104 2107 2106 2106 2106 2106 2106 2106 2105 2089 2104 2105]
            % d = 90%
            [1853 1857 1861 1864 1868 1869 1869 1874 1877 1876 1877 1877 1877 1880 1877 1880 1881 1881 1884 1881 1881 1881 1881 1881 1881 1880 1881 1879 1878 1880 1878 1877 1877 1879 1877 1877 1877 1877 1877 1880 1877 1877 1877 1876 1876 1877 1876 1876 1875 1875 1873 1873 1873 1875 1873 1873 1901]
            [1910 1896 1898 1902 1902 1904 1906 1908 1910 1911 1912 1912 1913 1913 1915 1925 1914 1913 1914 1913 1914 1912 1914 1913 1914 1911 1912 1908 1912 1911 1919 1909 1910 1910 1906 1908 1910 1907 1907 1904 1904 1903 1904 1903 1903 1903 1902 1901 1902 1901 1901 1900 1900 1900 1900 1898 1898]
            [1919 1925 1927 1928 1929 1931 1932 1935 1933 1936 1937 1937 1937 1937 1938 1938 1940 1938 1936 1936 1935 1936 1940 1935 1936 1933 1936 1933 1932 1932 1931 1929 1930 1928 1928 1928 1928 1928 1928 1927 1912 1925 1924 1924 1924 1923 1922 1920 1918 1919 1920 1923 1926 1928 1928 1932 1930]
            [1970 1944 1948 1950 1952 1953 1953 1955 1954 1957 1954 1955 1952 1956 1954 1957 1955 1954 1955 1955 1955 1954 1953 1953 1953 1953 1952 1951 1951 1949 1951 1949 1948 1948 1945 1944 1944 1931 1943 1939 1941 1943 1949 1952 1953 2015 1955 2015 1954 1957 1957 1958 1952 1957 1958 1956 1957]
            [1976 1979 1980 1983 1986 1986 1991 1990 1991 1991 1991 1992 1991 1991 1978 1991 1991 1990 1990 1987 1987 1994 1986 1986 1980 1981 1981 1979 1979 1979 1979 1979 1979 1976 1979 1979 1983 1987 1987 1987 1987 1970 1989 1991 1990 1991 1990 1991 1991 1990 1987 1987 1989 1986 1987 1986 1983]
            [2004 1994 1997 1999 1995 2002 2002 2003 2004 1999 2003 2004 2004 2004 2003 2004 2003 2003 2000 1999 1997 1999 2004 1997 1995 1995 1993 1995 1995 1993 1994 1997 2002 2002 2002 2003 2003 2003 1978 2004 2004 2004 2003 1968 2003 2000 2003 2000 1999 1999 1995 1996 1994 1992 1992 1991 1991]
            [2017 1995 2022 2025 2025 2026 2026 2026 2027 2028 2028 2026 2026 2026 2026 2025 2024 2025 2022 2022 2019 2013 2019 2019 2017 2016 2019 2020 2034 2025 2030 2027 2028 2029 2029 2028 2028 2027 2028 2025 2025 2026 2021 2024 2021 2019 1952 2019 2017 2017 2017 2019 2021 2024 2024 2026 2027]
            [2036 2038 2040 2041 2015 2043 2042 2060 2042 2044 2045 2045 2042 2043 2043 2042 2110 2041 2041 2038 2035 2034 2032 2037 2040 2041 2055 2044 2043 2044 2045 2044 2043 2043 2046 2042 2043 2015 2004 2031 2038 2038 2037 2038 2037 2034 2040 2042 2038 2044 2044 2045 2045 2045 2045 2044 2043]
            [2054 2055 2056 2057 2058 2058 2060 2061 2062 2061 2058 2058 2059 2058 2058 2059 2055 2057 2055 2054 2054 2055 2056 2056 2058 2058 2060 2058 2060 2060 2059 2060 2057 2059 2058 2055 2055 2055 2055 2054 2054 2055 2056 2040 2059 2061 2059 2061 2063 2059 2060 2059 2057 2057 2056 2003 2055]];

CUR_MEAN = mean(CUR_MEAS,2);
% 200 is the gain of the INA241A5
% 75 * 10^(-3) is the value of the current sensing resistor
% unites are in mA
CUR_VAL = CUR_MEAN(:,1) * (10^-3) / 200 / (75 * 10^(-3)); 

S_ANGLE_V = zeros(9,9);
S_TRANS_V = zeros(9,9);
S_CURRENT = zeros(9,9);
S_POWER_C = zeros(9,9);
S_ANGLE_EFF = zeros(9,9);
S_TRANS_EFF = zeros(9,9);

% looping over duty cycle
for d = 1:9
    % initialize frequency array index
    f = 1;
    
    % looping over frequency
    for freq = 10:5:50
        % read in the Vicon .csv file
        M = readtable('C:\Users\alexn\Documents\senior_thesis\actuator1\actuator1 f'+string(freq)+' d'+string(d)+'.csv', 'ReadVariableNames', false);
        numRows = height(M) + 2;
        M = readmatrix('C:\Users\alexn\Documents\senior_thesis\actuator1\actuator1 f'+string(freq)+' d'+string(d)+'.csv', 'Range', 'A6:H'+string(numRows));

        % unit processing
        M(:,2) = M(:,1) / 120;
        M(:,3) = M(:,3) * 180 / pi;
        M(:,4) = M(:,4) * 180 / pi;
        M(:,5) = M(:,5) * 180 / pi;

        % smoothing
        S = smoothdata(M,"gaussian",120); % window size of 120 to match frame/sampling rate

        % find valid initial and final indices
        firstValidIndex = find(~isnan(M(:,5)), 1);
        lastValidIndex = find(~isnan(M(:,5)), 1, 'last');

        % calculate angular velocity
        S_ANGLE_V(d,f) = (S(lastValidIndex, 5) - S(firstValidIndex, 5)) / 15;
        
        % calculate magnitude of translational velocity
        v_x = (S(lastValidIndex, 6) - S(firstValidIndex, 6)) / 15;
        v_y = (S(lastValidIndex, 7) - S(firstValidIndex, 7)) / 15;
        S_TRANS_V(d,f) = sqrt(v_x^2 + v_y^2);

        % calculate current consumption and power
        S_CURRENT(d,f) = CUR_VAL((d-1)*9 + f, 1);
        S_POWER_C(d,f) = S_CURRENT(d,f) * 7.4; % 7.4 is the total input voltage to eViper


        S_ANGLE_EFF(d,f) = abs(S_ANGLE_V(d,f)) / S_POWER_C(d,f);
        S_TRANS_EFF(d,f) = S_TRANS_V(d,f) / S_POWER_C(d,f);

        % increment frequency array indexing
        f = f + 1;
    end
end

%%
% close all;
clc;
% clear;
% load('nnet.mat');
load CustomColormap.mat;
%colormap jet %gray % jet

F = flip([0.125, 0.100, 0.083, 0.071, 0.063, 0.056, 0.050, 0.045, 0.042, 0.038].*10^6);
A = 0:0.1:0.9;
D1 = 0:0.1:0.9;
D2 = 0:0.1:0.9;
temp_duty = [0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9];
plot_duty1 = [ones(1,10)*0, ones(1,10)*0.1, ones(1,10)*0.2, ones(1,10)*0.3, ones(1,10)*0.4, ones(1,10)*0.5, ones(1,10)*0.6, ones(1,10)*0.7, ones(1,10)*0.8, ones(1,10)*0.9];
plot_duty2 = [temp_duty temp_duty temp_duty temp_duty temp_duty temp_duty temp_duty temp_duty temp_duty temp_duty];

figure(1)
filename = "ViewGIF_SpdOnly_xyDirection.gif"; % Specify the output file name
% SL = zeros(10, 10);
ExpSpdData = zeros(100, 10, 10) - 10;

for i=1:length(F)
    for j=1:length(A)
        % for k=1:length(D1)
        %     for l=1:length(D2)
        %         TrainInput=[100000./F(i),A(j),D1(k),D2(l)];
        %         TrainOutput=nnet(TrainInput');
        %         SL(l, k)=TrainOutput(1);              %Linear Speed
        %         %SR(k,l)=TrainOutput(2);              %Rotation Speed
        %         %P(k,l)=TrainOutput(3)*50;               %Power
        %     end
        % end
        %ExpSpdData(10*(i-1)+j, :, :) = SL;
        freqPhaseTitle = "Frequency = " + num2str(round(10^6/F(i), 0)) + " Hz, Phase = "+ num2str(A(j)*100) + " %, Exp";
        %scatter(plot_duty1*100, plot_duty2*100, 120, SL, 'filled');%colorbar;xlabel('Duty Ratio 1'),ylabel('Duty Ratio 2');title(["Linear Speed [cm/s], Experiment", freqPhaseTitle]);ax = gca;ax.FontWeight ='bold';ax.FontSize = 16;
        yvalues = {'10', '20', '30', '40', '50', '60', '70', '80', '90'};
        xvalues = {'10', '15', '20', '25', '30', '35', '40', '45', '50'};

        % uncomment one of the following lines to produce a heatmap
        %h = heatmap(xvalues, yvalues, S_ANGLE_V, 'CellLabelColor', 'none');
        %h = heatmap(xvalues, yvalues, S_TRANS_V, 'CellLabelColor', 'none');
        %h = heatmap(xvalues, yvalues, S_POWER_C, 'CellLabelColor', 'none');
        h = heatmap(xvalues, yvalues, S_ANGLE_EFF, 'CellLabelColor', 'none');
        %h = heatmap(xvalues, yvalues, S_TRANS_EFF, 'CellLabelColor', 'none');
        
        FontName = 'arial';
        FontSize = 20;
        FontWeight = 'bold';
        YDir = 'normal';
        h.FontColor = 'k';
        h.NodeChildren(3).FontName = FontName;
        h.NodeChildren(3).FontSize = FontSize;
        h.NodeChildren(3).FontWeight = FontWeight;
        h.NodeChildren(3).YDir = YDir;
        h.NodeChildren(2).FontName = FontName;
        h.NodeChildren(2).FontSize = FontSize;
        h.NodeChildren(2).FontWeight = FontWeight;
        %h.Title = freqPhaseTitle;
        %h.ColorbarVisible = 'off';
        %h.XLabel = 'Duty Ratio (Left, %)';
        %h.YLabel = 'Duty Ratio (Right, %)';
        h.YDisplayLabels = {'', '20', '', '40', '', '60', '', '80', ''};
        h.XDisplayLabels = {'10', '', '20', '', '30', '', '40', '', '50'};
        
        %colormap(CustomColormap);
        colormap jet;
        % uncomment one of the following below
        %caxis([-20, 15]); % S_ANGLE_V
        %caxis([0, 15]); % S_TRANS_V
        %caxis([0.8, 1.1]); % S_POWER_C
        caxis([0, 20]); % S_ANGLE_EFF
        %caxis([0, 15]); % S_TRANS_EFF
        
        
        % Temporarily change figure units 
        fh = gcf();  %if you don't already have the figure handle
        originalUnits.fig = fh.Units;  % save original units (probaly normalized)
        originalUnits.ax = h.Units; 
        fh.Units = 'centimeters';  % any unit that will result in squares
        h.Units = 'Normalize'; 
        % Get number of rows & columns
        sz = size(h.ColorData); 
        % make axes square (not the table cells, just the axes)
        h.Position(3:4) = min(h.Position(3:4))*[1,1]; 
        fh.InnerPosition(3:4) = min(fh.InnerPosition(3:4))*[1,1]; 
        % Change figure position;
        if sz(1)>sz(2)
            % make the figure size more narrow
            fh.InnerPosition(3) = fh.InnerPosition(3)*(sz(2)/sz(1)); 
        else
            % make the figure size shorter
            fh.InnerPosition(4) = fh.InnerPosition(4)*(sz(1)/sz(2)); 
        end
        % return original figure units
        fh.Units = originalUnits.fig; 
        h.Units = originalUnits.ax; 
        freqPhaseTitle = num2str(round(10^6/F(i), 0)) + "_" + num2str(A(j)*100) + "_exp.png"
        %saveas(gcf,freqPhaseTitle);
        
        %set(gca,'position',[0 0 1 1],'units','normalized')
        %set(gcf, 'position', [700, 700, 100, 100]);
        %set(gca,'position',[0 0 1 1])
        %axis off;
%         yticks([0 0.2 0.4 0.6 0.8]);
%         yticklabels({'0','0.2','0.4','0.6','0.8'});
        
        drawnow
        frame = getframe(1);
        im = frame2im(frame);
        %[imind,cm] = rgb2ind(im,256);
        %imind = im2gray(frame.cdata);
        
        if i==1 && j<10
            gifFilename = "./experimentPNGs_withLabels/image_0" + num2str(round(10*(i-1) + j)) + ".png";
        else
            gifFilename = "./experimentPNGs_withLabels/image_" + num2str(round(10*(i-1) + j)) + ".png";
        end
        %imwrite(im, gifFilename, 'png');
        %saveas(gcf,gifFilename);

%         if (i==1)&&(j==1)
%           imwrite(imind,cm,filename,'gif', 'Loopcount',inf);
%         else
%           imwrite(imind,cm,filename,'gif','WriteMode','append');
%         end
    end
end

%save("spdDataFromExp", "ExpSpdData");

%%

% initialize frames to measure average velocities from
init_start = 1;
init_end = 50;
final_start = 2100;
final_end = 2150;

% import for all docs
% num = 48;
% M = readtable('C:\Users\alexn\Documents\senior_thesis\2_28_2024\2_28_2024_Alex '+string(num)+'.csv', 'ReadVariableNames', false);
% numRows = height(M) + 2;
% M = readmatrix('C:\Users\alexn\Documents\senior_thesis\2_28_2024\2_28_2024_Alex '+string(num)+'.csv', 'Range', 'A6:H'+string(numRows));

freq = 40;
duty = 2;
M = readtable('C:\Users\alexn\Documents\senior_thesis\actuator1\actuator1 f'+string(freq)+' d'+string(duty)+'.csv', 'ReadVariableNames', false);
numRows = height(M) + 2;
M = readmatrix('C:\Users\alexn\Documents\senior_thesis\actuator1\actuator1 f'+string(freq)+' d'+string(duty)+'.csv', 'Range', 'A6:H'+string(numRows));

% unit processing
M(:,2) = M(:,1) / 120;
M(:,3) = M(:,3) * 180 / pi;
M(:,4) = M(:,4) * 180 / pi;
M(:,5) = M(:,5) * 180 / pi;

S = smoothdata(M,"gaussian",120);

% unsmoothed
close all;
figure(1);
subplot(2, 2, 1);
% plot(M(:,1), M(:,3));
% hold on;
% plot(M(:,1), M(:,4));
plot(M(:,1), M(:,5));
% legend({'angular disp. in X dir. (degree)', 'angular disp. in Y dir. (degree)', 'angular disp. in Z dir. (degree)'}, 'Location', 'east');
legend({'angular pos. in degrees'});
grid minor;
grid on;
hold off;

subplot(2, 2, 3);
plot(M(:,1), M(:,6));
legend({'X pos. (mm)'});
grid minor;
grid on;
hold off;

subplot(2, 2, 4);
plot(M(:,1), M(:,7));
legend({'Y pos. (mm)'});
grid minor;
grid on;
hold off;

sgtitle('actuator 4, frequency '+string(freq)+', duty cycle '+string(duty));

% smoothed
figure(2);
subplot(2, 2, 1);
% plot(M(:,1), M(:,3));
% hold on;
% plot(M(:,1), M(:,4));
plot(S(:,1), S(:,5));
% legend({'angular disp. in X dir. (degree)', 'angular disp. in Y dir. (degree)', 'angular disp. in Z dir. (degree)'}, 'Location', 'east');
legend({'angular pos. in degrees'});
grid minor;
grid on;
hold off;

subplot(2, 2, 3);
plot(S(:,1), S(:,6));
legend({'X pos. (mm)'});
grid minor;
grid on;
hold off;

subplot(2, 2, 4);
plot(S(:,1), S(:,7));
legend({'Y pos. (mm)'});
grid minor;
grid on;
hold off;

sgtitle('smoothed actuator 4, frequency '+string(freq)+', duty cycle '+string(duty));

% smoothed
figure(3);
subplot(2, 2, 1);
% plot(M(:,1), M(:,3));
% hold on;
% plot(M(:,1), M(:,4));
plot(M(:,1), M(:,5));
hold on;
plot(S(:,1), S(:,5));
% legend({'angular disp. in X dir. (degree)', 'angular disp. in Y dir. (degree)', 'angular disp. in Z dir. (degree)'}, 'Location', 'east');
legend({'angular pos. in degrees', 'smoothed angular pos. in degrees'});
grid minor;
grid on;
hold off;

subplot(2, 2, 3);
plot(M(:,1), M(:,6));
hold on;
plot(S(:,1), S(:,6));
legend({'X pos. (mm)', 'smoothed X pos. (mm)'});
grid minor;
grid on;
hold off;

subplot(2, 2, 4);
plot(M(:,1), M(:,7));
hold on;
plot(S(:,1), S(:,7));
legend({'Y pos. (mm)', 'smoothed Y pos. (mm)'});
grid minor;
grid on;
hold off;

sgtitle('smoothed vs unsmoothed actuator 4, frequency '+string(freq)+', duty cycle '+string(duty));

firstValidIndex = find(~isnan(M(:,5)), 1);
lasValidIndex = find(~isnan(M(:,5)), 1, 'last');

%%

% calculate angular velocity
init_angle = mean(M(init_start:init_end,5), "all");
final_angle = mean(M(final_start:final_end,5), "all");
avg_angle_vel = (final_angle - init_angle) / 15;
disp("ANGLE: ");
% disp(init_angle);
% disp(final_angle);
disp(avg_angle_vel);

% calculate x velocity
init_x = mean(M(init_start:init_end,6), "all");
final_x = mean(M(final_start:final_end,6), "all");
avg_x_vel = (final_x - init_x) / 15;
disp("X: ");
% disp(init_x);
% disp(final_x);
disp(avg_x_vel);

% calculate y velocity
init_y = mean(M(init_start:init_end,7), "all");
final_y = mean(M(final_start:final_end,7), "all");
avg_y_vel = (final_y - init_y) / 15;
disp("Y: ");
% disp(init_y);
% disp(final_y);
disp(avg_y_vel);

